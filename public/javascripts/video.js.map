{"version":3,"sources":["../../es6_public/video.es6"],"names":[],"mappings":"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","file":"video.js","sourcesContent":["'use strict';\n\n(function init () {\n  /* -------------------- hls.js -------------------- */\n\n  const hlsjsVideo = document.getElementById('hlsjsVideo')\n  if (window.Hls.isSupported()) {\n    const hls = new window.Hls({\n      liveDurationInfinity: true,\n      manifestLoadingTimeOut: 1000,\n      manifestLoadingMaxRetry: 30,\n      manifestLoadingRetryDelay: 500\n    })\n    hls.on(window.Hls.Events.ERROR, (event, data) => {\n      console.log('hls error', data)\n      console.log(data.type)\n      console.log(data.details)\n      //if (data.type === 'networkError') {\n      //hlsjsVideo.parentElement.innerHTML = '<p>hls.js network error</p>';\n      //}\n    })\n    hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\n      hlsjsVideo.play()\n    })\n    hls.attachMedia(hlsjsVideo)\n    hls.loadSource('/hls/test.m3u8')\n  } else {\n    hlsjsVideo.parentElement.innerHTML = '<p>hls.js not supported</p>'\n  }\n\n  /* -------------------- jpeg socket.io -------------------- */\n\n  const jpegImg = document.getElementById('jpegImg')\n  const jpegSocket = window.io.connect(`${window.location.origin}/jpeg`, {\n    transports: ['websocket'],\n    forceNew: true,\n    reconnection: true,\n    reconnectionDelay: 500\n  })\n  jpegSocket.on('jpeg', (data) => {\n    const arrayBufferView = new Uint8Array(data)\n    const blob = new window.Blob([arrayBufferView], {type: 'image/jpeg'})\n    const urlCreator = window.URL || window.webkitURL\n    jpegImg.src = urlCreator.createObjectURL(blob)\n  })\n\n  /* -------------------- progress -------------------- */\n\n  const progress = document.getElementById('progress')\n  const progressSocket = window.io.connect(`${window.location.origin}/progress`, {\n    transports: ['websocket'],\n    forceNew: true,\n    reconnection: true,\n    reconnectionDelay: 500\n  })\n  progressSocket.on('progress', (data) => {\n    progress.innerText = data\n  })\n\n  /* -------------------- m3u8 -------------------- */\n\n  const m3u8 = document.getElementById('m3u8')\n  const m3u8Socket = window.io.connect(`${window.location.origin}/m3u8`, {\n    transports: ['websocket'],\n    forceNew: true,\n    reconnection: true,\n    reconnectionDelay: 500\n  })\n  m3u8Socket.on('m3u8', (data) => {\n    m3u8.innerText = data\n  })\n\n  /* -------------------- mime -------------------- */\n\n  const mime = document.getElementById('mime')\n  const mimeSocket = window.io.connect(`${window.location.origin}/mse`, {\n    transports: ['websocket'],\n    forceNew: true,\n    reconnection: true,\n    reconnectionDelay: 500\n  })\n  mimeSocket.on('mime', (data) => {\n    const type = data.toLowerCase()\n    let message = type\n    if ('MediaSource' in window) {\n      message += '\\nMediaSource.isTypeSupported = ' + window.MediaSource.isTypeSupported(type)\n    } else {\n      message += '\\nMediaSource not supported by browser'\n    }\n    const vid = document.createElement('video')\n    message += '\\nHTMLMediaElement.canPlayType = ' + vid.canPlayType(type)\n    mime.innerText = message\n    mimeSocket.disconnect()\n  })\n  mimeSocket.emit('message', 'mime')\n\n  /* -------------------- stderr -------------------- */\n\n  const stderrArr = []\n  const stderr = document.getElementById('stderr')\n  const stderrSocket = window.io.connect(`${window.location.origin}/stderr`, {\n    transports: ['websocket'],\n    forceNew: true,\n    reconnection: true,\n    reconnectionDelay: 500\n  })\n  stderrSocket.on('stderr', (data) => {\n    stderrArr.push(data)\n    while (stderrArr.length > 200) {\n      stderrArr.shift()\n    }\n    stderr.innerText = stderrArr.join('\\n')\n  })\n\n  /* -------------------- progressive mp4 -------------------- */\n\n  const mp4Video = document.getElementById('mp4Video')\n  let mp4VideoLoads = 0\n  const loadMp4Video = () => {\n    mp4Video.src = '/mp4/test.mp4?t=' + new Date().toLocaleTimeString().split(' ').join('_')\n    mp4Video.load()\n    mp4VideoLoads++\n  }\n  mp4Video.addEventListener('canplay', (evt) => {\n    mp4VideoLoads = 0\n    mp4Video.play()\n  })\n  mp4Video.addEventListener('error', (evt) => {\n    if (mp4VideoLoads > 30) {\n      mp4Video.parentElement.innerHTML = '<p>progressive mp4 playback error</p>'\n      return\n    }\n    setTimeout(loadMp4Video, 500)\n  })\n  if (mp4Video.canPlayType('video/mp4')) {\n    loadMp4Video()\n  } else {\n    mp4Video.parentElement.innerHTML = '<p>progressive mp4 not supported</p>'\n  }\n\n  /* -------------------- native hls -------------------- */\n\n  const hlsVideo = document.getElementById('hlsVideo')\n  let hlsVideoLoads = 0\n  const loadHlsVideo = () => {\n    hlsVideo.src = '/hls/test.m3u8?t=' + new Date().toLocaleTimeString().split(' ').join('_')\n    hlsVideo.load()\n    hlsVideoLoads++\n  }\n  hlsVideo.addEventListener('canplay', (evt) => {\n    //console.log('can play');\n    hlsVideoLoads = 0\n    hlsVideo.play()\n  })\n  hlsVideo.addEventListener('error', (evt) => {\n    if (hlsVideoLoads > 30) {\n      hlsVideo.parentElement.innerHTML = '<p>native hls playback error</p>'\n      return\n    }\n    setTimeout(loadHlsVideo, 500)\n  })\n  if (hlsVideo.canPlayType('application/vnd.apple.mpegurl')) {\n    loadHlsVideo()\n  } else {\n    hlsVideo.parentElement.innerHTML = '<p>native hls not supported</p>'\n  }\n\n  /* -------------------- mjpeg -------------------- */\n\n  const mjpegImg = document.getElementById('mjpegImg')\n  mjpegImg.src = '/mjpeg/test.mjpg'\n  mjpegImg.addEventListener('error', (evt) => {\n    mjpegImg.parentElement.innerHTML = '<p>mjpeg playback error</p>'\n  })\n\n  /* -------------------- mse socket.io -------------------- */\n\n  const msePlayer = new window.VideoPlayer({\n    video: document.getElementById('mseVideo'),\n    io: window.io,\n    namespace: 'mse',\n    controls: ''\n  }, (err, msg) => {\n    if (err) {\n      console.error('mse', err)\n      console.log(document.getElementById('mseVideo').error)\n    }\n  })\n  msePlayer.start()\n\n  /* -------------------- cleanup -------------------- */\n\n  window.addEventListener('beforeunload', (evt) => {\n    stderrSocket.disconnect()\n    progressSocket.disconnect()\n    m3u8Socket.disconnect()\n    mimeSocket.disconnect()\n    jpegSocket.disconnect()\n    mjpegImg.src = ''\n    mp4Video.pause()\n    hlsVideo.pause()\n    hlsjsVideo.pause()\n    msePlayer.stop()\n  })\n\n})()\n"]}