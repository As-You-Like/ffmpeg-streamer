{"version":3,"sources":["../../es6_public/player.es6"],"names":[],"mappings":"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","file":"player.js","sourcesContent":["'use strict';\n\n// videoPlayers will be accessible in array `window.videoPlayers`\n\n(function mse (window) {\n  if (!('MediaSource' in window)) {\n    throw new Error('MediaSource not not supported by browser')\n  }\n\n  if (!('io' in window)) {\n    throw new Error('socket.io was not found')\n  }\n\n  // get all video elements on page\n\n  const videos = document.getElementsByTagName('video')\n\n  for (let i = 0; i < videos.length; i++) {\n    const video = videos[i]\n\n    // only grab video elements that have data-namespace attribute set\n\n    if (video.dataset.namespace) {\n      const videoPlayer = new VideoPlayer({\n\n        video: video,\n\n        io: window.io,\n\n        namespace: video.dataset.namespace,\n\n        controls: video.dataset.controls\n\n      })\n\n      if (video.autoplay) {\n        videoPlayer.start()\n      }\n    }\n  }\n})(window)\n\n/*\n\nlag 2 = threshold for current play time behind available buffer end time to trigger play head move, will split the measured lag difference / 2\n\npast 20 = duration of buffered video past current play time to trigger buffer removal\n\nkeep 5 = duration of buffer to keep past current play time when removing old buffer\n\n- too low of allowable lag will cause unstable playback\n\n- too high of allowable lag may cause realtime latency\n\n- removing too much past buffer can cause unstable playback\n\n- removing too little will increase memory use in browser for storing extra buffer\n\n*/\n\nconst config = {lag: 2.0, past: 20, keep: 5}\n\nclass VideoPlayer {\n  constructor (options, callback) {\n    if (typeof callback === 'function' && callback.length === 2) {\n      this._callback = callback\n    } else {\n      this._callback = (err, msg) => {\n        if (err) {\n          console.error(`VideoPlayer Error: ${err} Namespace: ${this._namespace}`)\n\n          return\n        }\n\n        console.log(`VideoPlayer Message: ${msg} Namespace: ${this._namespace}`)\n      }\n    }\n\n    if (!window.MediaSource) {\n      // this._video.setAttribute('poster', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxyZWN0IHg9Ii0xIiB5PSItMSIgd2lkdGg9IjY0MiIgaGVpZ2h0PSIzNiIgZmlsbD0ibm9uZSIvPjwvZz48Zz48dGV4dCBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE3NyIgeT0iMjYiIGZvbnQtc2l6ZT0iMjYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0cm9rZT0iIzAwMCI+bWltZSB0eXBlIG5vdCBzdXBwb3J0ZWQ8L3RleHQ+PC9nPjwvc3ZnPg==')\n\n      this._callback('MediaSource not supported by browser')\n\n      return\n    }\n\n    if (!options.video || !(options.video instanceof window.HTMLVideoElement)) {\n      this._callback('\"options.video\" is not a video element')\n\n      return\n    }\n\n    if (!options.namespace) {\n      this._callback('missing \"options.namespace\"')\n\n      return\n    }\n\n    if (!options.io || !options.io.hasOwnProperty('Socket')) {\n      this._callback('\"options.io is not an instance of socket.io')\n\n      return\n    }\n\n    this._video = options.video\n\n    if (options.controls) {\n      const stb = options.controls.indexOf('startstop') !== -1\n\n      const fub = options.controls.indexOf('fullscreen') !== -1\n\n      const snb = options.controls.indexOf('snapshot') !== -1\n\n      const cyb = options.controls.indexOf('cycle') !== -1\n\n      // todo: mute and volume buttons will be determined automatically based on codec string\n\n      if (stb || fub || snb || cyb) {\n        this._container = document.createElement('div')\n\n        this._container.className = 'mse-container'\n\n        this._video.parentNode.replaceChild(this._container, this._video)\n\n        this._video.className = 'mse-video'\n\n        this._video.controls = false\n\n        this._video.removeAttribute('controls')\n\n        this._container.appendChild(this._video)\n\n        this._controls = document.createElement('div')\n\n        this._controls.className = 'mse-controls'\n\n        this._container.appendChild(this._controls)\n\n        if (stb) {\n          this._startstop = document.createElement('button')\n\n          this._startstop.className = 'mse-start'\n\n          this._startstop.addEventListener('click', (/* event */) => {\n            this.togglePlay()\n          })\n\n          this._controls.appendChild(this._startstop)\n        }\n\n        if (fub) {\n          this._fullscreen = document.createElement('button')\n\n          this._fullscreen.className = 'mse-fullscreen'\n\n          this._fullscreen.addEventListener('click', (/* event */) => {\n            if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {\n              if (this._container.requestFullscreen) {\n                this._container.requestFullscreen()\n              } else if (this._container.msRequestFullscreen) {\n                this._container.msRequestFullscreen()\n              } else if (this._container.mozRequestFullScreen) {\n                this._container.mozRequestFullScreen()\n              } else if (this._container.webkitRequestFullscreen) {\n                this._container.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT)\n              }\n            } else {\n              if (document.exitFullscreen) {\n                document.exitFullscreen()\n              } else if (document.msExitFullscreen) {\n                document.msExitFullscreen()\n              } else if (document.mozCancelFullScreen) {\n                document.mozCancelFullScreen()\n              } else if (document.webkitExitFullscreen) {\n                document.webkitExitFullscreen()\n              }\n            }\n          })\n\n          this._controls.appendChild(this._fullscreen)\n        }\n\n        if (snb) {\n          this._snapshot = document.createElement('button')\n\n          this._snapshot.className = 'mse-snapshot'\n\n          this._snapshot.addEventListener('click', (/* event */) => {\n            if (this._video.readyState < 2) {\n              this._callback(null, `readyState: ${this._video.readyState} < 2`)\n\n              return\n            }\n\n            // safari bug, cannot use video as source for canvas drawImage when it is being used as media source extension (only works when using regular m3u8 playlist)\n\n            // will hide icon until creating a server side response to deliver a snapshot\n\n            const canvas = document.createElement('canvas')\n\n            // this._container.appendChild(canvas);\n\n            canvas.width = this._video.videoWidth\n\n            canvas.height = this._video.videoHeight\n\n            const ctx = canvas.getContext('2d')\n\n            ctx.drawImage(this._video, 0, 0, canvas.width, canvas.height)\n\n            const href = canvas.toDataURL('image/jpeg', 1.0)\n\n            const link = document.createElement('a')\n\n            link.href = href\n\n            const date = new Date().getTime()\n\n            link.download = `${this._namespace}-${date}-snapshot.jpeg`\n\n            // link must be added so that link.click() will work on firefox\n\n            this._container.appendChild(link)\n\n            link.click()\n\n            this._container.removeChild(link)\n          })\n\n          this._controls.appendChild(this._snapshot)\n        }\n\n        if (cyb) {\n          this._cycle = document.createElement('button')\n\n          this._cycle.className = 'mse-cycle'\n\n          this._cycling = false\n\n          if (options.cycleTime) {\n            const int = parseInt(options.cycleTime)\n\n            if (int < 2) {\n              this._cycleTime = 2000\n            } else if (int > 10) {\n              this._cycleTime = 10000\n            } else {\n              this._cycleTime = int * 1000\n            }\n          } else {\n            this._cycleTime = 2000\n          }\n\n          this._cycle.addEventListener('click', (/* event */) => {\n            if (!this._cycling) {\n              this._namespaces = []\n\n              this._cycleIndex = 0\n\n              const videoPlayers = window.videoPlayers\n\n              for (let i = 0; i < videoPlayers.length; i++) {\n                this._namespaces.push(videoPlayers[i].namespace)\n\n                if (videoPlayers[i] !== this) {\n                  videoPlayers[i].disabled = true\n                } else {\n                  this._cycleIndex = i\n                }\n              }\n\n              if (this._namespaces.length < 2) {\n                this._callback(null, 'unable to cycle because namespaces < 2')\n\n                delete this._namespaces\n\n                delete this._cycleIndex\n\n                return\n              }\n\n              if (!this._playing) {\n                this.start()\n              }\n\n              if (this._startstop) {\n                this._startstop.classList.add('cycling')\n              }\n\n              this._cycle.classList.add('animated')\n\n              this._cycleInterval = setInterval(() => {\n                this._cycleIndex++\n\n                if (this._cycleIndex === this._namespaces.length) {\n                  this._cycleIndex = 0\n                }\n\n                this.start(this._namespaces[this._cycleIndex])\n              }, this._cycleTime)\n\n              this._cycling = true\n            } else {\n              clearInterval(this._cycleInterval)\n\n              this._cycle.classList.remove('animated')\n\n              if (this._startstop) {\n                this._startstop.classList.remove('cycling')\n              }\n\n              this.start()\n\n              const videoPlayers = window.videoPlayers\n\n              for (let i = 0; i < videoPlayers.length; i++) {\n                if (videoPlayers[i] !== this) {\n                  videoPlayers[i].disabled = false\n                }\n              }\n\n              delete this._namespaces\n\n              delete this._cycleInterval\n\n              this._cycling = false\n            }\n          })\n\n          this._controls.appendChild(this._cycle)\n        }\n      }\n    }\n\n    this._namespace = options.namespace\n\n    this._io = options.io\n\n    if (!window.videoPlayers) {\n      window.videoPlayers = []\n    }\n\n    window.videoPlayers.push(this)\n\n    this._canStart = true\n\n    return this\n  }\n\n  get namespace () {\n    return this._namespace || null\n  }\n\n  set namespace (value) {\n    this._namespace = value\n  }\n\n  /** @return {boolean} */\n\n  get disabled () {\n    if (!this._container) {\n      return false\n    }\n\n    return this._container.classList.contains('disabled')\n  }\n\n  /** @param {boolean} bool */\n\n  set disabled (bool) {\n    if (!this._container) {\n      return\n    }\n\n    if (bool === true) {\n      if (this._container.classList.contains('disabled')) {\n        return\n      }\n\n      this._container.classList.add('disabled')\n\n      this.stop()\n    } else {\n      if (!this._container.classList.contains('disabled')) {\n        return\n      }\n\n      this._container.classList.remove('disabled')\n\n      this.start()\n    }\n  }\n\n  /* ----------------------- public methods ----------------------- */\n\n  mediaInfo () {\n    let str = `******************\\n`\n\n    str += `namespace : ${this._namespace}\\n`\n\n    if (this._video) {\n      str += `video.paused : ${this._video.paused}\\nvideo.currentTime : ${this._video.currentTime}\\nvideo.src : ${this._video.src}\\n`\n\n      if (this._sourceBuffer.buffered.length) {\n        str += `buffered.length : ${this._sourceBuffer.buffered.length}\\nbuffered.end(0) : ${this._sourceBuffer.buffered.end(0)}\\nbuffered.start(0) : ${this._sourceBuffer.buffered.start(0)}\\nbuffered size : ${this._sourceBuffer.buffered.end(0) - this._sourceBuffer.buffered.start(0)}\\nlag : ${this._sourceBuffer.buffered.end(0) - this._video.currentTime}\\n`\n      }\n    }\n\n    str += `******************\\n`\n\n    console.info(str)\n  }\n\n  togglePlay () {\n    if (this._playing === true) {\n      this.stop()\n    } else {\n      this.start()\n    }\n\n    return this\n  }\n\n  start (namespace) {\n    if (!this._canStart) {\n      return this._callback('cannot start player')\n    }\n\n    if (!namespace) {\n      namespace = this._namespace\n    }\n\n    // todo maybe pass namespace as parameter to start(namespace) to accommodate cycling feature\n\n    if (this._playing === true) {\n      this.stop()\n    }\n\n    if (this._startstop) {\n      this._startstop.classList.add('mse-stop')\n\n      this._startstop.classList.remove('mse-start')\n\n      this._startstop.disabled = true\n    }\n\n    this._playing = true\n\n    this._socket = this._io(`${window.location.origin}/${namespace}`, {transports: ['websocket'], forceNew: false})\n\n    this._addSocketEvents()\n\n    if (this._startstop) {\n      this._startstop.disabled = false\n    }\n\n    return this\n  }\n\n  stop () {\n    if (this._startstop) {\n      this._startstop.classList.add('mse-start')\n\n      this._startstop.classList.remove('mse-stop')\n\n      this._startstop.disabled = true\n    }\n\n    this._playing = false\n\n    if (this._video) {\n      this._removeVideoEvents()\n\n      this._video.pause()\n\n      this._video.removeAttribute('src')\n\n      // this._video.src = '';//todo: not sure if NOT removing this will cause memory leak\n\n      this._video.load()\n    }\n\n    if (this._socket) {\n      this._removeSocketEvents()\n\n      if (this._socket.connected) {\n        this._socket.disconnect()\n      }\n\n      delete this._socket\n    }\n\n    if (this._mediaSource) {\n      this._removeMediaSourceEvents()\n\n      if (this._mediaSource.sourceBuffers && this._mediaSource.sourceBuffers.length) {\n        this._mediaSource.removeSourceBuffer(this._sourceBuffer)\n      }\n\n      delete this._mediaSource\n    }\n\n    if (this._sourceBuffer) {\n      this._removeSourceBufferEvents()\n\n      if (this._sourceBuffer.updating) {\n        this._sourceBuffer.abort()\n      }\n\n      delete this._sourceBuffer\n    }\n\n    if (this._startstop) {\n      this._startstop.disabled = false\n    }\n\n    return this\n  }\n\n  destroy () {\n    // todo: possibly strip control buttons and other layers added around video player\n\n    return this\n  }\n\n  /* ----------------------- video element events ----------------------- */\n\n  _onVideoError (event) {\n    this._callback(`video error ${event.type}`)\n  }\n\n  _onVideoLoadedData (event) {\n    this._callback(null, `video loaded data ${event.type}`)\n\n    if ('Promise' in window) {\n      this._video.play()\n\n        .then(() => {\n\n        // this._callback(null, 'play promise fulfilled');\n\n        // todo remove \"click to play\" poster\n\n        })\n\n        .catch((error) => {\n          this._callback(error)\n\n        // todo add \"click to play\" poster\n        })\n    } else {\n      this._video.play()\n    }\n  }\n\n  _addVideoEvents () {\n    if (!this._video) {\n      return\n    }\n\n    this.onVideoError = this._onVideoError.bind(this)\n\n    this._video.addEventListener('error', this.onVideoError, {capture: true, passive: true, once: true})\n\n    this.onVideoLoadedData = this._onVideoLoadedData.bind(this)\n\n    this._video.addEventListener('loadeddata', this.onVideoLoadedData, {capture: true, passive: true, once: true})\n\n    this._callback(null, 'added video events')\n  }\n\n  _removeVideoEvents () {\n    if (!this._video) {\n      return\n    }\n\n    this._video.removeEventListener('error', this.onVideoError, {capture: true, passive: true, once: true})\n\n    delete this.onVideoError\n\n    this._video.removeEventListener('loadeddata', this.onVideoLoadedData, {capture: true, passive: true, once: true})\n\n    delete this.onVideoLoadedData\n\n    this._callback(null, 'removed video events')\n  }\n\n  /* ----------------------- media source events ----------------------- */\n\n  _onMediaSourceClose (event) {\n    this._callback(null, `media source close ${event.type}`)\n  }\n\n  _onMediaSourceOpen (/* event */) {\n    window.URL.revokeObjectURL(this._video.src)\n\n    this._mediaSource.duration = Number.POSITIVE_INFINITY\n\n    this._sourceBuffer = this._mediaSource.addSourceBuffer(this._mime)\n\n    this._sourceBuffer.mode = 'sequence'// chrome was complaining about timestamps when set to sequence\n\n    // this._sourceBuffer.mode = 'segments';\n\n    this._addSourceBufferEvents()\n\n    this._sourceBuffer.appendBuffer(this._init)\n\n    // this._video.setAttribute('poster', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxyZWN0IHg9Ii0xIiB5PSItMSIgd2lkdGg9IjY0MiIgaGVpZ2h0PSIzNiIgZmlsbD0ibm9uZSIvPjwvZz48Zz48dGV4dCBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE2MCIgeT0iMjYiIGZvbnQtc2l6ZT0iMjYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0cm9rZT0iIzAwMCI+cmVxdWVzdGluZyBtZWRpYSBzZWdtZW50czwvdGV4dD48L2c+PC9zdmc+');\n\n    this.onSegment = this._onSegment.bind(this)\n\n    this._socket.addEventListener('segment', this.onSegment, {capture: true, passive: true, once: false})\n\n    this._socket.send('segments')\n\n    // this._video.muted = true;\n  }\n\n  _addMediaSourceEvents () {\n    if (!this._mediaSource) {\n      return\n    }\n\n    this.onMediaSourceClose = this._onMediaSourceClose.bind(this)\n\n    this._mediaSource.addEventListener('sourceclose', this.onMediaSourceClose, {\n\n      capture: true,\n\n      passive: true,\n\n      once: true\n\n    })\n\n    this.onMediaSourceOpen = this._onMediaSourceOpen.bind(this)\n\n    this._mediaSource.addEventListener('sourceopen', this.onMediaSourceOpen, {capture: true, passive: true, once: true})\n  }\n\n  _removeMediaSourceEvents () {\n    if (!this._mediaSource) {\n      return\n    }\n\n    this._mediaSource.removeEventListener('sourceclose', this.onMediaSourceClose, {\n\n      capture: true,\n\n      passive: true,\n\n      once: true\n\n    })\n\n    delete this.onMediaSourceClose\n\n    this._mediaSource.removeEventListener('sourceopen', this.onMediaSourceOpen, {\n\n      capture: true,\n\n      passive: true,\n\n      once: true\n\n    })\n\n    delete this.onMediaSourceOpen\n  }\n\n  /* ----------------------- source buffer events ----------------------- */\n\n  _onSourceBufferError (event) {\n    this._callback(`sourceBufferError ${event.type}`)\n  }\n\n  _onSourceBufferUpdateEnd (/* event */) {\n    // cant do anything to sourceBuffer if it is updating\n\n    if (this._sourceBuffer.updating) {\n      return\n    }\n\n    // if has last segment pending, append it\n\n    if (this._lastSegment) {\n      // this._callback(null, 'using this._lastSegment');\n\n      this._sourceBuffer.appendBuffer(this._lastSegment)\n\n      delete this._lastSegment\n\n      return\n    }\n\n    // check if buffered media exists\n\n    if (!this._sourceBuffer.buffered.length) {\n      return\n    }\n\n    // current time of play position\n\n    const currentTime = this._video.currentTime\n\n    // start time for currently buffered video\n\n    const start = this._sourceBuffer.buffered.start(0)\n\n    // end time for currently buffered video\n\n    const end = this._sourceBuffer.buffered.end(0)\n\n    // duration of currently buffered video behind current play time\n\n    const past = currentTime - start\n\n    // todo play with numbers and make dynamic or user configurable\n\n    if (past > config.past && currentTime < end) {\n      this._sourceBuffer.remove(start, currentTime - config.keep)\n    }\n  }\n\n  _addSourceBufferEvents () {\n    if (!this._sourceBuffer) {\n      return\n    }\n\n    this.onSourceBufferError = this._onSourceBufferError.bind(this)\n\n    this._sourceBuffer.addEventListener('error', this.onSourceBufferError, {capture: true, passive: true, once: true})\n\n    this.onSourceBufferUpdateEnd = this._onSourceBufferUpdateEnd.bind(this)\n\n    this._sourceBuffer.addEventListener('updateend', this.onSourceBufferUpdateEnd, {\n\n      capture: true,\n\n      passive: true,\n\n      once: false\n\n    })\n  }\n\n  _removeSourceBufferEvents () {\n    if (!this._sourceBuffer) {\n      return\n    }\n\n    this._sourceBuffer.removeEventListener('error', this.onSourceBufferError, {\n\n      capture: true,\n\n      passive: true,\n\n      once: true\n\n    })\n\n    delete this.onSourceBufferError\n\n    this._sourceBuffer.removeEventListener('updateend', this.onSourceBufferUpdateEnd, {\n\n      capture: true,\n\n      passive: true,\n\n      once: false\n\n    })\n\n    delete this.onSourceBufferUpdateEnd\n  }\n\n  /* ----------------------- socket.io events ----------------------- */\n\n  _onSocketConnect (/* event */) {\n    // this._callback(null, 'socket connect');\n\n    // this._video.setAttribute('poster', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxyZWN0IHg9Ii0xIiB5PSItMSIgd2lkdGg9IjY0MiIgaGVpZ2h0PSIzNiIgZmlsbD0ibm9uZSIvPjwvZz48Zz48dGV4dCBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE5NiIgeT0iMjYiIGZvbnQtc2l6ZT0iMjYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0cm9rZT0iIzAwMCI+cmVxdWVzdGluZyBtaW1lIHR5cGU8L3RleHQ+PC9nPjwvc3ZnPg==');\n\n    this.onMime = this._onMime.bind(this)\n\n    this._socket.addEventListener('mime', this.onMime, {capture: true, passive: true, once: true})\n\n    this._socket.send('mime')\n  }\n\n  _onSocketDisconnect (event) {\n    this._callback(null, `socket disconnect \"${event}\"`)\n\n    this.stop()\n  }\n\n  _onSocketError (event) {\n    this._callback(`socket error \"${event}\"`)\n\n    this.stop()\n  }\n\n  _onMime (data) {\n    this._mime = data\n\n    if (!window.MediaSource.isTypeSupported(this._mime)) {\n      this._video.setAttribute('poster', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxyZWN0IHg9Ii0xIiB5PSItMSIgd2lkdGg9IjY0MiIgaGVpZ2h0PSIzNiIgZmlsbD0ibm9uZSIvPjwvZz48Zz48dGV4dCBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE3NyIgeT0iMjYiIGZvbnQtc2l6ZT0iMjYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0cm9rZT0iIzAwMCI+bWltZSB0eXBlIG5vdCBzdXBwb3J0ZWQ8L3RleHQ+PC9nPjwvc3ZnPg==')\n\n      this._callback(`unsupported mime \"${this._mime}\"`)\n\n      return\n    }\n\n    // this._video.setAttribute('poster', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxyZWN0IHg9Ii0xIiB5PSItMSIgd2lkdGg9IjY0MiIgaGVpZ2h0PSIzNiIgZmlsbD0ibm9uZSIvPjwvZz48Zz48dGV4dCBmaWxsPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAiIHg9IjE4NiIgeT0iMjYiIGZvbnQtc2l6ZT0iMjYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0cm9rZT0iIzAwMCI+cmVxdWVzdGluZyBpbml0IHNlZ21lbnQ8L3RleHQ+PC9nPjwvc3ZnPg==');\n\n    this.onInit = this._onInit.bind(this)\n\n    this._socket.addEventListener('initialization', this.onInit, {capture: true, passive: true, once: true})\n\n    this._socket.send('initialization')\n  }\n\n  _onInit (data) {\n    this._init = data\n\n    this._mediaSource = new window.MediaSource()\n\n    this._addMediaSourceEvents()\n\n    this._addVideoEvents()\n\n    this._video.src = window.URL.createObjectURL(this._mediaSource)\n  }\n\n  _onSegment (data) {\n    if (this._sourceBuffer.buffered.length) {\n      const lag = this._sourceBuffer.buffered.end(0) - this._video.currentTime\n\n      if (lag > config.lag) {\n        // move play head, split the difference between buffer end time and current play time\n\n        this._video.currentTime = this._sourceBuffer.buffered.end(0) - lag / 2\n      }\n    }\n\n    if (this._sourceBuffer.updating) {\n      this._lastSegment = data\n    } else {\n      delete this._lastSegment\n\n      this._sourceBuffer.appendBuffer(data)\n    }\n  }\n\n  _addSocketEvents () {\n    if (!this._socket) {\n      return\n    }\n\n    this.onSocketConnect = this._onSocketConnect.bind(this)\n\n    this._socket.addEventListener('connect', this.onSocketConnect, {capture: true, passive: true, once: true})\n\n    this.onSocketDisconnect = this._onSocketDisconnect.bind(this)\n\n    this._socket.addEventListener('disconnect', this.onSocketDisconnect, {capture: true, passive: true, once: true})\n\n    this.onSocketError = this._onSocketError.bind(this)\n\n    this._socket.addEventListener('error', this.onSocketError, {capture: true, passive: true, once: true})\n  }\n\n  _removeSocketEvents () {\n    if (!this._socket) {\n      return\n    }\n\n    this._socket.removeEventListener('connect', this.onSocketConnect, {capture: true, passive: true, once: true})\n\n    delete this.onSocketConnect\n\n    this._socket.removeEventListener('disconnect', this.onSocketDisconnect, {capture: true, passive: true, once: true})\n\n    delete this.onSocketDisconnect\n\n    this._socket.removeEventListener('error', this.onSocketError, {capture: true, passive: true, once: true})\n\n    delete this.onSocketError\n\n    this._socket.removeEventListener('mime', this.onMime, {capture: true, passive: true, once: true})\n\n    delete this.onMime\n\n    this._socket.removeEventListener('initialization', this.onInit, {capture: true, passive: true, once: true})\n\n    delete this.onInit\n\n    this._socket.removeEventListener('segment', this.onSegment, {capture: true, passive: true, once: false})\n\n    delete this.onSegment\n  }\n}\n\n// todo steps for creation of video player\n\n// script is loaded at footer so that it can run after html is ready on page\n\n// verify that socket.io is defined in window\n\n// iterate each video element that has custom data-namespace attributes that we need\n\n// initiate socket to get information from server\n\n// first request codec string to test against browser and then feed first into source\n\n// then request init-segment to feed\n\n// then request media segments until we run into pause, stop, close, error, buffer not ready, etc\n\n// change poster on video element based on current status, error, not ready, etc\n"]}